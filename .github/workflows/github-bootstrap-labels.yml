name: Update repository labels

on:
  push:
    branches:
    - main
    paths:
    - '.github/workflows/bootstrap-labels.yml'

jobs:
  create-labels:
    runs-on: ubuntu-latest
    permissions:
      issues: write
    env:
      LABELS_JSON: |
        [
          {"name": "dependencies", "color": "ededed", "description": "Dependency updates"},
          {"name": "documentation", "color": "0075ca", "description": "Improvements or additions to documentation"},
          {"name": "tests", "color": "d876e3", "description": "Related to tests"},
          {"name": "devcontainer", "color": "0e8a16", "description": "Related to development container"},
          {"name": "vscode", "color": "1d76db", "description": "Related to Visual Studio Code settings"},
          {"name": "ci-cd", "color": "bfdadc", "description": "Related to GitHub Actions CI"},
          {"name": "build", "color": "5319e7", "description": "Build related changes"},
          {"name": "github", "color": "6e5494", "description": "GitHub configuration changes"},
          {"name": "breaking", "color": "ff0000", "description": "Breaking changes"},
          {"name": "feature", "color": "0e8a16", "description": "New feature or enhancement"},
          {"name": "bugfix", "color": "d73a4a", "description": "Bug fix"},
          {"name": "performance", "color": "5319e7", "description": "Performance improvements"}
        ]
    steps:
    - uses: actions/github-script@ed597411d8f924073f98dfc5c65a23a2325f34cd #v8.0.0
      with:
        script: |
          const labels = JSON.parse(process.env.LABELS_JSON);
          for (const label of labels) {
            try {
              await github.rest.issues.createLabel({
                owner: context.repo.owner,
                repo: context.repo.repo,
                name: label.name,
                description: label.description || '',
                color: label.color
              });
            } catch (error) {
              // Check if the error is because the label already exists
              if (error.status === 422) {
                console.log(`Label '${label.name}' already exists. Skipping.`);
              } else {
                // Log other errors
                console.error(`Error creating label '${label.name}': ${error}`);
              }
            }
          }